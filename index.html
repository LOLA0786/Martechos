<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MartechOS AI - Working Version</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 py-4">
                <h1 class="text-2xl font-bold text-green-600">‚úÖ MartechOS AI - WORKING</h1>
                <p class="text-sm text-gray-600">API Test: Successful</p>
            </div>
        </header>

        <section class="py-16 bg-white">
            <div class="max-w-4xl mx-auto px-4">
                <h2 class="text-3xl font-bold text-center mb-8">üéØ AI Creative Generator</h2>
                
                <div class="max-w-2xl mx-auto bg-gray-50 p-8 rounded-lg border">
                    <form id="creativeForm">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">What do you want to promote?</label>
                            <input type="text" id="prompt" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="e.g., Coffee shop, Fitness app, Tech product..." 
                                   value="Organic skincare products" required>
                        </div>
                        
                        <button type="submit" id="generateBtn"
                                class="w-full bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 font-semibold">
                            <i class="fas fa-rocket mr-2"></i>Generate Creative
                        </button>
                    </form>

                    <div id="result" class="mt-6 hidden">
                        <div class="bg-white p-6 rounded-lg shadow border">
                            <h3 class="text-xl font-semibold mb-4">üé® Your Generated Ad</h3>
                            <img id="creativeImage" src="" class="w-full h-48 object-cover rounded-lg mb-4 border">
                            <div class="bg-blue-50 p-4 rounded-lg mb-4">
                                <p id="creativeCopy" class="text-lg text-gray-800 font-medium"></p>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Predicted CTR: <strong id="ctr" class="text-green-600"></strong></span>
                                <span class="text-sm text-blue-600" id="confidence"></span>
                            </div>
                        </div>
                    </div>

                    <div id="loading" class="hidden text-center py-8">
                        <i class="fas fa-spinner fa-spin text-3xl text-blue-600 mb-3"></i>
                        <p>Generating your creative...</p>
                    </div>

                    <div id="error" class="hidden bg-red-50 p-4 rounded-lg mt-4">
                        <p class="text-red-800" id="errorMessage"></p>
                    </div>
                </div>

                <!-- Test Examples -->
                <div class="max-w-2xl mx-auto mt-8">
                    <h3 class="font-semibold mb-3">üí° Try these examples:</h3>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="testExample('Coffee shop morning specials')" class="bg-gray-100 p-3 rounded text-sm hover:bg-gray-200">
                            ‚òï Coffee Shop
                        </button>
                        <button onclick="testExample('Fitness app for beginners')" class="bg-gray-100 p-3 rounded text-sm hover:bg-gray-200">
                            üí™ Fitness App
                        </button>
                        <button onclick="testExample('Tech gadgets for remote work')" class="bg-gray-100 p-3 rounded text-sm hover:bg-gray-200">
                            üñ•Ô∏è Tech Gadgets
                        </button>
                        <button onclick="testExample('Sustainable fashion brand')" class="bg-gray-100 p-3 rounded text-sm hover:bg-gray-200">
                            üëó Fashion Brand
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- API Status -->
        <div class="max-w-2xl mx-auto px-4 mb-8">
            <div class="bg-green-50 p-4 rounded-lg">
                <h3 class="font-semibold text-green-800 mb-2">‚úÖ API Status</h3>
                <p class="text-green-700 text-sm">Server is running and responding correctly. Creative generation is working!</p>
            </div>
        </div>
    </div>

    <script>
        function testExample(text) {
            document.getElementById('prompt').value = text;
            document.getElementById('creativeForm').dispatchEvent(new Event('submit'));
        }

        document.getElementById('creativeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const prompt = document.getElementById('prompt').value;
            const button = document.getElementById('generateBtn');
            
            // Show loading, hide others
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('result').classList.add('hidden');
            document.getElementById('error').classList.add('hidden');
            
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
            button.disabled = true;

            try {
                console.log('üîÑ Sending request for:', prompt);
                
                const response = await fetch('/api/generate-creative', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        platform: 'instagram',
                        targetAudience: 'general'
                    })
                });

                console.log('üì® Response status:', response.status);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('‚úÖ Received data:', data);

                // Update UI
                document.getElementById('creativeImage').src = data.image_url;
                document.getElementById('creativeImage').alt = data.ad_copy;
                document.getElementById('creativeCopy').textContent = data.ad_copy;
                document.getElementById('ctr').textContent = data.ctr_prediction + '%';
                document.getElementById('confidence').textContent = data.confidence_score + ' confidence';

                // Show results
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('result').classList.remove('hidden');

            } catch (error) {
                console.error('‚ùå Error:', error);
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('error').classList.remove('hidden');
                document.getElementById('errorMessage').textContent = 'Error: ' + error.message;
            } finally {
                button.innerHTML = '<i class="fas fa-rocket mr-2"></i>Generate Creative';
                button.disabled = false;
            }
        });

        // Test the API on load
        console.log('üöÄ Testing API connection...');
        fetch('/api/status')
            .then(r => r.json())
            .then(data => console.log('‚úÖ API Status:', data))
            .catch(err => console.log('‚ùå API Test Failed:', err));
    </script>
</body>
</html>
